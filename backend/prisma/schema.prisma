// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enum for user roles
enum Role {
  GUEST
  USER
  ADMIN
}

// User model
model User {
  id           String   @id @default(uuid())
  email        String   @unique
  password     String
  firstName    String   @map("first_name")
  lastName     String   @map("last_name")
  role         Role     @default(USER)
  isBlocked    Boolean  @default(false) @map("is_blocked")
  avatar       String?
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Relations
  savedBooks   SavedBook[]
  playlists    Playlist[]
  reviews      Review[]
  
  @@map("users")
}

// Category model - kept for filtering/search purposes
model Category {
  id          String   @id @default(uuid())
  name        String   @unique
  nameUk      String?  @map("name_uk") // Ukrainian translation
  description String?
  slug        String   @unique
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("categories")
}

// Saved books (user's personal library) - only Open Library books
model SavedBook {
  id            String   @id @default(uuid())
  userId        String   @map("user_id")
  openLibraryId String   @map("open_library_id") // Open Library ID
  savedAt       DateTime @default(now()) @map("saved_at")

  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, openLibraryId], name: "saved_books_user_id_open_library_id_key")
  @@index([userId])
  @@map("saved_books")
}

// Playlist model - user-created playlists
model Playlist {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  name        String
  description String?
  isPublic    Boolean  @default(false) @map("is_public")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  books       PlaylistBook[]

  @@index([userId])
  @@map("playlists")
}

// PlaylistBook - books in playlists
model PlaylistBook {
  id            String   @id @default(uuid())
  playlistId    String   @map("playlist_id")
  openLibraryId String   @map("open_library_id") // Open Library ID
  order         Int      @default(0) // Order in playlist
  addedAt       DateTime @default(now()) @map("added_at")

  playlist      Playlist @relation(fields: [playlistId], references: [id], onDelete: Cascade)

  @@unique([playlistId, openLibraryId], name: "playlist_books_playlist_id_open_library_id_key")
  @@index([playlistId])
  @@map("playlist_books")
}

// Review model - user reviews and ratings for books
model Review {
  id            String   @id @default(uuid())
  userId        String   @map("user_id")
  openLibraryId String   @map("open_library_id") // Open Library ID
  rating        Int      // Rating 1-5
  title         String?
  comment       String?
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, openLibraryId], name: "reviews_user_id_open_library_id_key") // One review per user per book
  @@index([openLibraryId])
  @@map("reviews")
}





